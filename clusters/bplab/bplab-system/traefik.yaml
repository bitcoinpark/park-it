---
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: traefik
  namespace: bplab-system
spec:
  interval: 1h
  url: https://traefik.github.io/charts
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: traefik
  namespace: bplab-system
spec:
  interval: 5m
  chart:
    spec:
      chart: traefik
      version: "33.0.0"
      sourceRef:
        kind: HelmRepository
        name: traefik
        namespace: bplab-system
  values:
    ingressClass:
      enabled: true
      isDefaultClass: true
      name: traefik-internal
    providers:
      kubernetesIngress:
        publishedService:
          enabled: true
      kubernetesCRD:
        allowCrossNamespace: true
    priorityClassName: "system-cluster-critical"
    tolerations:
      - key: "CriticalAddonsOnly"
        operator: "Exists"
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Exists"
        effect: "NoSchedule"
      - key: "node-role.kubernetes.io/master"
        operator: "Exists"
        effect: "NoSchedule"
    service:
      annotations:
        metallb.universe.tf/loadBalancerIPs: 10.21.0.150
      ipFamilyPolicy: "PreferDualStack"
    logs:
      general:
        level: ERROR
      access:
        enabled: false
    ports:
      # mainnet
      bitcoind-8332:
        expose:
          default: true
        port: 8332
        exposedPort: 8332
        protocol: TCP
      bitcoind-28332:
        expose:
          default: true
        port: 28332
        exposedPort: 28332
        protocol: TCP
      bitcoind-28333:
        expose:
          default: true
        port: 28333
        exposedPort: 28333
        protocol: TCP
      # testnet4
      bitcoind-18332:
        expose:
          default: true
        port: 18332
        exposedPort: 18332
        protocol: TCP
      bitcoind-18444:
        expose:
          default: true
        port: 18444
        exposedPort: 18444
        protocol: TCP
      bitcoind-18445:
        expose:
          default: true
        port: 18445
        exposedPort: 18445
        protocol: TCP
      # signet
      bitcoind-38332:
        expose:
          default: true
        port: 38332
        exposedPort: 38332
        protocol: TCP
      bitcoind-38444:
        expose:
          default: true
        port: 38444
        exposedPort: 38444
        protocol: TCP
      bitcoind-38445:
        expose:
          default: true
        port: 38445
        exposedPort: 38445
        protocol: TCP
      # mainnet
      fulcrum-50001:
        expose:
          default: true
        port: 50001
        exposedPort: 50001
        protocol: TCP
      fulcrum-50002:
        expose:
          default: true
        port: 50002
        exposedPort: 50002
        protocol: TCP
      # testnet4
      fulcrum-40001:
        expose:
          default: true
        port: 40001
        exposedPort: 40001
        protocol: TCP
      fulcrum-40002:
        expose:
          default: true
        port: 40002
        exposedPort: 40002
        protocol: TCP
      # signet
      fulcrum-30001:
        expose:
          default: true
        port: 30001
        exposedPort: 30001
        protocol: TCP
      fulcrum-30002:
        expose:
          default: true
        port: 30002
        exposedPort: 30002
        protocol: TCP
